<div class="p-4">
    <div class="flex justify-content-between align-items-center mb-4">
        <h2 class="text-2xl font-bold text-900 m-0">{{ editMode ? 'Modifier Acte' : 'Nouvel Acte' }}</h2>
        <div class="flex gap-2">
            <p-button label="Annuler" severity="secondary" (onClick)="cancel()" icon="pi pi-times"></p-button>
            <p-button label="Enregistrer l'acte" (onClick)="save()" icon="pi pi-check"
                [disabled]="!newActe.numeroActe || !newActe.type"></p-button>
        </div>
    </div>

    <div class="card p-4 glass">
        <p-fluid>
            <div class="grid">
                <div class="col-12 md:col-6 field mb-4">
                    <label for="numero" class="block text-900 font-medium mb-2">Numéro d'acte</label>
                    <input pInputText id="numero" [(ngModel)]="newActe.numeroActe" placeholder="Ex: 2024/001"
                        class="w-full" />
                </div>

                <div class="col-12 md:col-6 field mb-4">
                    <label for="type" class="block text-900 font-medium mb-2">Type d'acte</label>
                    <p-select id="type" [options]="acteTypes" [(ngModel)]="newActe.type" optionLabel="label"
                        optionValue="value" placeholder="Sélectionner le type" class="w-full"></p-select>
                </div>

                <div class="col-12 md:col-6 field mb-4">
                    <label for="date" class="block text-900 font-medium mb-2">Date de l'acte</label>
                    <p-datepicker id="date" [(ngModel)]="newActe.dateActe" dateFormat="dd/mm/yy" [showIcon]="true"
                        class="w-full"></p-datepicker>
                </div>

                <div class="col-12 md:col-6 field mb-4 flex align-items-end">
                    <div class="flex align-items-center gap-2">
                        <input type="checkbox" id="cloture" [(ngModel)]="newActe.cloture" />
                        <label for="cloture">Marquer comme clôturé</label>
                    </div>
                </div>
            </div>

            <!-- Parties Section -->
            <div class="grid mt-4">
                <div class="col-12">
                    <h3 class="text-xl font-bold mb-3">Parties de l'acte</h3>
                </div>

                <div class="col-12 md:col-4 field">
                    <label class="block mb-2">Type de Client</label>
                    <p-selectbutton [options]="clientTypeOptions" [(ngModel)]="selectedClientType" optionLabel="label"
                        optionValue="value"></p-selectbutton>
                </div>

                <div class="col-12 md:col-8 field">
                    <label class="block mb-2">Rechercher un client</label>
                    <p-autocomplete [(ngModel)]="selectedClient" [suggestions]="filteredClients"
                        (completeMethod)="searchClient($event)" [delay]="0" [forceSelection]="true"
                        optionLabel="displayName" placeholder="Tapez pour rechercher (CIN, Nom, ICE...)" class="w-full">
                        <ng-template let-client pTemplate="item">
                            <div *ngIf="selectedClientType === 'physique'">
                                <div>{{client.nom}} {{client.prenom}}</div>
                                <div class="text-sm text-500">CIN: {{client.cin}}</div>
                            </div>
                            <div *ngIf="selectedClientType === 'morale'">
                                <div>{{client.raisonSociale}}</div>
                                <div class="text-sm text-500">ICE: {{client.ice}}</div>
                            </div>
                        </ng-template>
                    </p-autocomplete>
                </div>

                <div class="col-12 md:col-6 field">
                    <label class="block mb-2">Qualité</label>
                    <p-select [options]="qualites" [(ngModel)]="selectedQualite" optionLabel="label" optionValue="value"
                        class="w-full"></p-select>
                </div>

                <div class="col-12 md:col-6 field flex align-items-end">
                    <p-button label="Ajouter la partie" icon="pi pi-plus" (onClick)="addPartie()"
                        [disabled]="!selectedClient"></p-button>
                </div>

                <div class="col-12 mt-3">
                    <p-table [value]="parties" styleClass="p-datatable-sm p-datatable-gridlines">
                        <ng-template pTemplate="header">
                            <tr>
                                <th>Client</th>
                                <th>Qualité</th>
                                <th style="width: 100px">Actions</th>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="body" let-partie let-i="rowIndex">
                            <tr>
                                <td>{{partie.clientNom}}</td>
                                <td>{{partie.qualite}}</td>
                                <td>
                                    <p-button icon="pi pi-trash" [rounded]="true" [text]="true" severity="danger"
                                        (onClick)="removePartie(i)"></p-button>
                                </td>
                            </tr>
                        </ng-template>
                        <ng-template pTemplate="emptymessage">
                            <tr>
                                <td colspan="3" class="text-center">Aucune partie ajoutée.</td>
                            </tr>
                        </ng-template>
                    </p-table>
                </div>
            </div>
        </p-fluid>
    </div>

    <p-toast></p-toast>
</div>