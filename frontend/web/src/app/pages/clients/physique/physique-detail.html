<div class="p-4">
    <div class="flex justify-content-between align-items-center mb-4">
        <h2 class="text-2xl font-bold text-900 m-0">{{ editMode ? 'Modifier' : 'Nouveau' }} Client Physique</h2>
        <div class="flex gap-2">
            <p-button label="Annuler" severity="secondary" (onClick)="cancel()" icon="pi pi-times"></p-button>
            <p-button label="Enregistrer" (onClick)="save()" icon="pi pi-check"
                [disabled]="!client.cin || !client.nom || !client.prenom"></p-button>
        </div>
    </div>

    <div class="card p-4 glass">
        <p-tabs value="0">
            <p-tablist>
                <p-tab value="0">
                    <i class="pi pi-user mr-2"></i>
                    Informations
                </p-tab>
                <p-tab value="1" *ngIf="editMode && client.id">
                    <i class="pi pi-folder mr-2"></i>
                    Documents
                </p-tab>
            </p-tablist>
            <p-tabpanels>
                <p-tabpanel value="0">
                    <p-fluid>
                        <div class="grid">
                            <!-- Identité -->
                            <div class="col-12 text-xl font-bold mb-3">Identité</div>
                            <div class="col-12 md:col-6 field">
                                <label class="font-medium">CIN</label>
                                <input pInputText [(ngModel)]="client.cin" (blur)="checkCin()" [disabled]="editMode" />
                                <small class="p-error" *ngIf="cinExists">Ce CIN existe déjà</small>
                            </div>

                            <div class="col-12 md:col-6 field">
                                <label class="font-medium">Nationalité</label>
                                <input pInputText [(ngModel)]="client.nationalite" />
                            </div>

                            <div class="col-12 md:col-6 field">
                                <label class="font-medium">Prénom (Français)</label>
                                <input pInputText [(ngModel)]="client.prenom" />
                            </div>
                            <div class="col-12 md:col-6 field">
                                <label class="font-medium">Nom (Français)</label>
                                <input pInputText [(ngModel)]="client.nom" />
                            </div>

                            <!-- RTL Fields -->
                            <div class="col-12 md:col-6 field" dir="rtl">
                                <label class="font-medium">الإسم الشخصي (Arabe)</label>
                                <input pInputText [(ngModel)]="client.prenomAr" class="text-right" />
                            </div>
                            <div class="col-12 md:col-6 field" dir="rtl">
                                <label class="font-medium">الإسم العائلي (Arabe)</label>
                                <input pInputText [(ngModel)]="client.nomAr" class="text-right" />
                            </div>

                            <div class="col-12 md:col-6 field">
                                <label class="font-medium">Date de Naissance</label>
                                <p-datepicker [(ngModel)]="dateNaissance" dateFormat="dd/mm/yy"
                                    [showIcon]="true"></p-datepicker>
                            </div>
                            <div class="col-12 md:col-6 field">
                                <label class="font-medium">Lieu de Naissance</label>
                                <input pInputText [(ngModel)]="client.lieuNaissance" />
                            </div>

                            <!-- Contact -->
                            <div class="col-12 text-xl font-bold mt-4 mb-3">Contact</div>
                            <div class="col-12 md:col-6 field">
                                <label class="font-medium">Téléphone</label>
                                <input pInputText [(ngModel)]="client.telephone" />
                            </div>
                            <div class="col-12 md:col-6 field">
                                <label class="font-medium">Email</label>
                                <input pInputText [(ngModel)]="client.email" />
                            </div>

                            <!-- Adresses -->
                            <div class="col-12 text-xl font-bold mt-4 mb-3">Adresses</div>
                            <div class="col-12">
                                <p-table [value]="client.adresses || []"
                                    styleClass="p-datatable-sm p-datatable-gridlines">
                                    <ng-template pTemplate="header">
                                        <tr>
                                            <th>Adresse</th>
                                            <th>Ville</th>
                                            <th>Code Postal</th>
                                            <th>Pays</th>
                                            <th style="width: 100px">Actions</th>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="body" let-addr let-i="rowIndex">
                                        <tr>
                                            <td>{{addr.adresse}}</td>
                                            <td>{{addr.ville}}</td>
                                            <td>{{addr.codePostal}}</td>
                                            <td>{{addr.pays}}</td>
                                            <td>
                                                <p-button icon="pi pi-trash" [rounded]="true" [text]="true"
                                                    severity="danger" (onClick)="removeAdresse(i)"></p-button>
                                            </td>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="emptymessage">
                                        <tr>
                                            <td colspan="5" class="text-center">Aucune adresse. <a
                                                    (click)="showAdresseDialog = true"
                                                    class="text-primary cursor-pointer font-bold">Ajouter une
                                                    adresse</a></td>
                                        </tr>
                                    </ng-template>
                                </p-table>
                                <div class="mt-2">
                                    <p-button label="Ajouter Adresse" icon="pi pi-plus" [outlined]="true"
                                        (onClick)="showAdresseDialog = true"></p-button>
                                </div>
                            </div>
                        </div>
                    </p-fluid>
                </p-tabpanel>
                <p-tabpanel value="1" *ngIf="editMode && client.id">
                    <app-file-explorer [clientId]="client.id"></app-file-explorer>
                </p-tabpanel>
            </p-tabpanels>
        </p-tabs>
    </div>

    <p-dialog [(visible)]="showAdresseDialog" header="Nouvelle Adresse" [modal]="true" [style]="{width: '450px'}">
        <p-fluid>
            <div class="field">
                <label>Adresse</label>
                <textarea pTextarea [(ngModel)]="newAdresse.adresse" rows="3"></textarea>
            </div>
            <div class="field grid">
                <div class="col-6">
                    <label>Ville</label>
                    <input pInputText [(ngModel)]="newAdresse.ville" />
                </div>
                <div class="col-6">
                    <label>Code Postal</label>
                    <input pInputText [(ngModel)]="newAdresse.codePostal" />
                </div>
            </div>
            <div class="field">
                <label>Pays</label>
                <input pInputText [(ngModel)]="newAdresse.pays" />
            </div>
        </p-fluid>
        <ng-template pTemplate="footer">
            <p-button label="Annuler" icon="pi pi-times" [text]="true" (onClick)="showAdresseDialog = false"></p-button>
            <p-button label="Ajouter" icon="pi pi-check" (onClick)="addAdresse()"
                [disabled]="!newAdresse.adresse || !newAdresse.ville"></p-button>
        </ng-template>
    </p-dialog>

    <p-toast></p-toast>
</div>